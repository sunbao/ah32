# TODO: PPT(WPP) Agentic 智能演示文稿生成计划

## 背景
PPT 操作不应是简单的"点击工具栏"，而是通过 **Agentic 对话** 让 AI 理解用户的演示需求，自动生成 Plan 创建完整的演示文稿。

---

## 核心理念

**用户需求** → **AI 理解演示目的** → **AI 设计幻灯片结构** → **自动生成 Plan 执行** → **完整 PPT 呈现**

---

## 落地现状（2026-02-20）

这份文档偏“愿景规划”。以当前代码为准：
- ✅ 已有 `ah32.plan.v1` + `host_app=wpp` 的可执行闭环：`add_slide/add_textbox/add_table/add_shape/set_*` 等（best-effort）。
- ✅ `add_textbox` 支持按占位符优先填充（`placeholder_kind/placeholder_type/placeholder_index`）；当未给占位符/坐标时，执行侧会尽量自动填充空的 title/body 占位符，并在坐标兜底时尽量使用占位框尺寸（减少“坐标拍脑袋”）。
- ✅ 图片插入的可落地策略（best-effort + 不阻塞 Plan）：
  - 支持 `data:image/...` Data URL 剪贴板粘贴；失败降级为占位形状。
  - 支持 `http(s)://...` URL：`AddPicture` 失败时会尝试“同步下载 -> 剪贴板粘贴”；并在单次 Plan 内对同一 URL 复用缓存，减少重复下载翻车。
  - 支持 Plan 级资源库：`meta.resources.images=[{id,data_url}]` + `add_image.path="res:<id>"`，便于复用同一张图。
- ⏳ 仍未实现：真正的“图片资源管线”（本地路径/临时文件/下载生命周期与清理、跨 Plan 复用与缓存持久化）。

---

## 阶段一：需求理解层

### 1.1 演示场景识别

| 场景 | 适用场景 | 幻灯片结构 |
|------|----------|------------|
| 产品介绍 | 新产品发布、功能演示 | 封面 → 痛点 → 方案 → 功能 → 优势 → 案例 → 价格 → 结尾 |
| 项目汇报 | 项目进度、成果展示 | 封面 → 背景 → 目标 → 进度 → 成果 → 问题 → 计划 → 结尾 |
| 培训课件 | 知识培训、技能教学 | 封面 → 目录 → 要点1 → 要点2 → 要点3 → 总结 → 问答 |
| 商业计划 | 融资、战略规划 | 封面 → 愿景 → 市场 → 产品 → 商业模式 → 团队 → 财务 → 结尾 |
| 年度总结 | 工作总结、述职 | 封面 → 目录 → 成绩 → 亮点 → 不足 → 计划 → 结尾 |

### 1.2 内容结构设计

根据用户输入自动设计幻灯片结构：
- 页数规划（5页/10页/20页等）
- 每页内容类型（标题页/目录/正文/图表/总结）
- 叙事逻辑（总-分-总/问题-解决方案/时间线）

---

## 阶段二：内容生成

### 2.1 幻灯片内容规划

| 操作 | 说明 | Plan Op |
|------|------|---------|
| 生成标题 | 每页标题文字 | add_textbox |
| 生成正文 | 要点、描述文字 | add_textbox |
| 生成图表数据 | 图表所需数据 | add_chart + data |
| 生成表格数据 | 表格内容 | add_table |
| 配图建议 | 图片位置和描述 | add_image（支持占位符/坐标；失败会降级为占位形状） |

### 2.2 版式智能推荐

根据内容类型自动推荐版式：

| 内容类型 | 推荐版式ID |
|----------|------------|
| 封面/标题页 | 1-5 |
| 目录页 | 6-10 |
| 纯文本 | 11-20 |
| 两栏内容 | 21-35 |
| 图表页 | 36-50 |
| 图片页 | 51-65 |
| 混合内容 | 66-80 |

---

## 阶段三：执行操作

### 3.1 幻灯片操作（自动执行）

| 操作 | 说明 | Plan Op |
|------|------|---------|
| 创建幻灯片 | 添加新页 | add_slide |
| 设置版式 | 应用版式模板 | set_slide_layout |
| 删除幻灯片 | 删除指定页 | delete_slide |
| 复制幻灯片 | 复制页 | duplicate_slide |
| 重新排序 | 调整页序 | reorder_slides |

### 3.2 内容操作（自动填充）

| 操作 | 说明 | Plan Op |
|------|------|---------|
| 添加文本框 | 标题、正文 | add_textbox |
| 添加图片 | 占位图、素材图 | add_image |
| 添加图表 | 柱状图、折线图、饼图 | add_chart |
| 添加表格 | 数据表格 | add_table |
| 添加形状 | 装饰形状 | add_shape |

### 3.3 样式操作（自动应用）

| 操作 | 说明 | Plan Op |
|------|------|---------|
| 设置背景 | 主题背景 | set_slide_background |
| 设置主题 | 主题样式 | set_slide_theme |
| 设置切换 | 页面切换动画 | set_slide_transition |
| 添加动画 | 元素入场动画 | add_animation |
| 设置动画时间 | 动画时长、延迟 | set_animation_timing |

---

## 阶段四：Skill 设计

### 4.1 ppt-builder Skill

**目标**：智能生成完整演示文稿

**输入**：
- 用户需求描述（主题、场景、页数）
- 现有素材（文档、数据）

**输出**：
- 幻灯片结构设计
- 每页内容
- 可执行 Plan（创建幻灯片 + 添加内容 + 设置样式）

**能力清单**：
```json
{
  "understand_requirement": "理解演示需求和场景",
  "design_structure": "设计幻灯片结构",
  "generate_content": "生成每页内容",
  "recommend_layout": "推荐版式",
  "create_slides": "创建幻灯片",
  "add_visual": "添加图表、图片",
  "apply_style": "应用主题和动画"
}
```

### 4.2 ppt-outline Skill（改造）

**目标**：大纲生成 + 内容填充

**现状**：只输出文字建议
**目标**：输出完整 Plan + 执行

---

## 阶段五：典型场景

### 场景1：产品介绍 PPT
```
用户："帮我做一个新产品介绍PPT，介绍我们的AI助手产品"

AI 理解：
- 场景：产品介绍
- 推荐结构：8页
- 风格：科技、专业

Plan 生成：
1. add_slide（封面，版式1，标题"AI智能助手"）
2. add_slide（目录，版式6）
3. add_slide（痛点分析，版式12）
4. add_slide（产品功能，版式25）
5. add_chart（功能对比，柱状图）
6. add_slide（优势总结，版式18）
7. add_slide（客户案例，版式35）
8. add_slide（联系页，版式5）
9. set_slide_theme（主题：科技蓝）
10. set_slide_transition（淡入）
```

### 场景2：项目汇报 PPT
```
用户："做一个季度项目汇报PPT"

AI 理解：
- 场景：项目汇报
- 推荐结构：10页
- 风格：商务、简洁

Plan 生成：
1. add_slide（封面）
2. add_slide（目录）
3. add_slide（项目背景）
4. add_slide（目标回顾）
5. add_slide（进度时间线）
6. add_slide（成果数据，图表）
7. add_slide（遇到的问题）
8. add_slide（下一步计划）
9. add_slide（总结）
10. add_slide（Q&A）
```

---

## 实现顺序

1. **ppt-builder Skill** - 需求理解 + 结构设计
2. **版式推荐增强** - recommend_layout 工具优化
3. **内容填充增强** - 文本、图表数据自动生成
4. **样式增强** - 主题、切换、动画
5. **ppt-outline 改造** - 输出 Plan 而非建议

---

## 技术要点

1. **需求感知**：理解用户场景（产品介绍/项目汇报/培训等）
2. **结构设计**：根据场景推荐最佳幻灯片结构
3. **内容生成**：AI 生成每页标题、正文、数据
4. **自动执行**：生成完整 Plan，一次性创建完整 PPT

---

## 示例 Plan 输出

```json
{
  "schema_version": "ah32.plan.v1",
  "host_app": "wpp",
  "meta": {
    "scenario": "product_intro",
    "title": "AI智能助手产品介绍",
    "page_count": 8,
    "style": "科技"
  },
  "actions": [
    {
      "id": "slide_1",
      "title": "封面页",
      "op": "add_slide",
      "layout": 1,
      "title": "AI智能助手",
      "content": "让工作更高效"
    },
    {
      "id": "slide_2",
      "title": "目录页",
      "op": "add_slide",
      "layout": 6
    },
    {
      "id": "slide_3",
      "title": "痛点分析",
      "op": "add_slide",
      "layout": 12,
      "title": "当前痛点"
    },
    {
      "id": "slide_4_text",
      "title": "产品功能正文",
      "op": "add_textbox",
      "text": "1. 智能问答\n2. 自动写作\n3. 数据分析",
      "left": 1.5,
      "top": 3,
      "width": 20,
      "height": 8,
      "slide_index": 4
    },
    {
      "id": "slide_5_chart",
      "title": "功能对比图",
      "op": "add_chart",
      "chart_type": "bar",
      "title": "功能对比",
      "data": [["功能", "竞品", "我们"], ["响应速度", 60, 95], ["准确率", 70, 92], ["易用性", 65, 90]],
      "slide_index": 5
    },
    {
      "id": "theme",
      "title": "应用科技主题",
      "op": "set_slide_theme",
      "theme_name": "科技"
    },
    {
      "id": "transition",
      "title": "设置切换效果",
      "op": "set_slide_transition",
      "effect": "fade",
      "apply_to_all": true
    }
  ]
}
```

---

## 阶段五：高级智能能力（思维链/思维树/规划/迭代）

### 5.1 思维链（Chain of Thought）

让 AI 在生成 Plan 前展示推理过程：

```json
{
  "meta": {
    "reasoning": [
      "1. 需求理解：用户要做产品介绍PPT，目标受众是企业客户",
      "2. 结构规划：8页结构（封面→目录→痛点→方案→功能→优势→案例→结尾）",
      "3. 版式选择：封面用版式1（标题页），目录用版式6，两栏内容用版式25",
      "4. 内容填充：标题页突出品牌，两栏页展示对比优势，图表页用数据说话",
      "5. 风格确定：科技蓝色调，专业商务风格"
    ]
  }
}
```

**实现方式**：
- 在 SYSTEM.md 中要求 AI 输出 reasoning 字段
- 前端展示推理过程供用户确认
- 用户可干预修改 Plan

### 5.2 思维树（Tree of Thought）

探索多种 PPT 方案，选择最优：

```json
{
  "meta": {
    "alternatives": [
      {
        "方案A": "传统结构：封面→目录→内容→总结，适合保守客户",
        "方案B": "故事结构：问题→解决方案→优势→案例，逻辑性强",
        "方案C": "数据驱动：封面→大数据→图表→结论，适合技术产品"
      },
      "推荐方案B，故事结构最能打动企业客户"
    ]
  }
}
```

**实现方式**：
- 要求 AI 生成 2-3 个备选方案
- 每个方案包含：结构、版式、风格、内容要点
- 用户选择后执行

### 5.3 规划能力（Planning）

复杂 PPT 自动分解为多阶段：

```
用户："帮我做一个完整的产品发布会PPT"

分解为：
├── 阶段1：策划设计
│   ├── 确定主题与风格
│   ├── 规划页数与结构
│   └── 选择版式配色
├── 阶段2：内容生成
│   ├── 生成封面文案
│   ├── 生成各页标题
│   ├── 编写正文内容
│   └── 准备图表数据
├── 阶段3：视觉设计
│   ├── 应用主题配色
│   ├── 调整版式布局
│   └── 添加动画效果
└── 阶段4：审核优化
    ├── 检查内容一致性
    └── 优化视觉效果
```

**实现方式**：
- Plan 支持嵌套阶段（phase/step）
- Executor 按阶段执行，支持暂停确认
- 每个阶段完成后用户可预览

### 5.4 持续迭代（Iterative Execution）

执行→检查→调整→继续：

```
执行循环：
├── 阶段1: 创建8页幻灯片 → 检查：8页创建成功 ✓
├── 阶段2: 填充标题内容 → 检查：标题1偏短 → 补充内容 → ✓
├── 阶段3: 添加图表 → 检查：图表颜色不协调 → 调整配色 → ✓
├── 阶段4: 添加动画 → 检查：动画过多 → 精简为淡入 → ✓
└── 完成：用户预览后可继续调整
```

**实现方式**：
- Executor 返回每步执行结果和快照
- AI 检查结果是否达到预期
- 偏差 > 阈值时自动调整后续操作
- 支持用户干预："第三页太满了" → 拆分内容

---

## 实现顺序

### 阶段规划

| 阶段 | 内容 | 优先级 |
|------|------|--------|
| 阶段一 | 需求理解层 | 已完成 |
| 阶段二 | 内容生成 | P1 |
| 阶段三 | 执行操作 | 已完成 |
| 阶段四 | Skill 设计 | P1 |
| 阶段五 | 思维链/思维树/规划/迭代 | P2/P3 |

### 阶段五细分

| 阶段 | 内容 | 优先级 |
|------|------|--------|
| 5.1 | 思维链（reasoning 字段） | P2 |
| 5.2 | 思维树（alternatives 字段） | P2 |
| 5.3 | 规划能力（phase/step 嵌套） | P3 |
| 5.4 | 持续迭代（执行-检查-调整） | P3 |
