{
  "schema_version": "ah32.skill.v1",
  "meta": {
    "id": "answer-mode",
    "name": "Answer Mode（写回题干）",
    "version": "0.2.0",
    "enabled": true,
    "priority": 55,
    "description": "在现有试题/表单中按题号定位括号/下划线/横线并写回答案，尽量不改动题干。",
    "group": "exam"
  },
  "delivery": {
    "default_writeback": "direct"
  },
  "routing": {
    "hosts": [
      "writer"
    ],
    "tags": [
      "答题",
      "填空",
      "写回",
      "题号",
      "选择题",
      "问卷"
    ],
    "intents": [
      "answer_mode",
      "writeback"
    ],
    "triggers": [
      "填答案",
      "填入答案",
      "写回答案",
      "把答案写回",
      "答题",
      "做题",
      "选择题",
      "填空题",
      "括号",
      "下划线",
      "横线",
      "题号",
      "第1题",
      "答案："
    ],
    "examples": [
      "把第1-5题答案填到括号里：1.A 2.C 3.B 4.D 5.A",
      "把下划线处填空：1. 北京 2. 2026年",
      "在试卷原文中按题号填答案，不要改题干"
    ]
  },
  "capabilities": {
    "active_doc_text": true,
    "active_doc_max_chars": 60000
  },
  "output": {
    "markers": [
      "AnswerMode",
      "题号",
      "括号",
      "下划线",
      "不改题干"
    ],
    "output_schema": "输出必须是可执行 Plan JSON（schema_version=ah32.plan.v1，host_app=wps），并使用 op=answer_mode_apply（answers=[{q,answer}]）按题号定位并填充答案；不改动题干正文；写回需幂等（重复执行不重复插入）。若找不到题号/占位符，必须抛出可读错误（包含题号）。",
    "max_chars": 2400
  },
  "entry": {
    "system_prompt": "SYSTEM.txt"
  },
  "tools": [
    {
      "name": "placeholder_detector",
      "description": "检测括号/方括号/下划线/横线等答题占位符（默认读取当前文档，无需传 doc_text）",
      "parameters": {
        "type": "object",
        "properties": {
          "doc_text": {
            "type": "string",
            "description": "文档全文（可省略，默认使用当前文档）"
          },
          "context_chars": {
            "type": "integer",
            "description": "返回占位符前后文字符数"
          },
          "max_results": {
            "type": "integer",
            "description": "最多返回多少个占位符"
          }
        },
        "required": []
      }
    },
    {
      "name": "position_calculator",
      "description": "按题号定位锚点+占位符位置，并检测是否已存在写回标记（默认读取当前文档，无需传 doc_text）",
      "parameters": {
        "type": "object",
        "properties": {
          "doc_text": {
            "type": "string",
            "description": "文档全文（可省略，默认使用当前文档）"
          },
          "answers": {
            "type": "array",
            "description": "题号与答案（答案可空，仅用于题号定位）",
            "items": {
              "type": "object",
              "properties": {
                "q": { "type": "string" },
                "answer": { "type": "string" }
              },
              "required": ["q"]
            }
          },
          "block_id": {
            "type": "string",
            "description": "用于生成幂等 marker 的 block_id"
          },
          "search_window_chars": {
            "type": "integer",
            "description": "锚点后搜索占位符的窗口大小"
          },
          "context_chars": {
            "type": "integer",
            "description": "返回占位符前后文字符数（用于调试）"
          },
          "max_results": {
            "type": "integer",
            "description": "最多处理/返回多少题"
          }
        },
        "required": ["answers"]
      }
    },
    {
      "name": "answer_writer",
      "description": "生成 answer_mode_apply 的 Plan JSON（不包含题干原文）",
      "parameters": {
        "type": "object",
        "properties": {
          "answers": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "q": { "type": "string" },
                "answer": { "type": "string" }
              },
              "required": ["q"]
            }
          },
          "block_id": { "type": "string" },
          "strict": { "type": "boolean" },
          "search_window_chars": { "type": "integer" },
          "backup": { "type": "boolean" }
        },
        "required": ["answers"]
      }
    }
  ]
}
