{
  "schema_version": "ah32.skill.v1",
  "meta": {
    "id": "bidding-helper",
    "name": "招投标助手",
    "version": "0.2.1",
    "enabled": true,
    "priority": 40,
    "description": "面向招投标/标书场景：符合性/偏离矩阵、澄清问题清单、证据定位与风险建议。",
    "group": "bidding"
  },
  "routing": {
    "hosts": [
      "writer"
    ],
    "tags": [
      "招投标",
      "投标",
      "标书",
      "招标文件",
      "响应",
      "符合性",
      "偏离",
      "澄清",
      "评分"
    ],
    "intents": [
      "bidding",
      "compliance_matrix",
      "risk"
    ],
    "triggers": [
      "招标",
      "投标",
      "标书",
      "招标文件",
      "投标文件",
      "响应文件",
      "资格审查",
      "门槛",
      "符合性",
      "偏离",
      "偏离表",
      "响应表",
      "技术条款",
      "商务条款",
      "评分",
      "技术响应",
      "商务响应",
      "澄清",
      "答疑",
      "应答"
    ],
    "examples": [
      "根据招标文件输出符合性/偏离表，并列出需要澄清的问题",
      "把技术条款逐条应答，给出证据定位与风险提示"
    ]
  },
  "output": {
    "markers": [
      "符合性/偏离矩阵",
      "澄清问题清单",
      "证据定位",
      "风险与建议",
      "自检清单"
    ],
    "output_schema": "输出必须包含并使用以下标题：1) 执行摘要；2) 符合性/偏离矩阵（含证据定位）；3) 澄清问题清单（含章节定位）；4) 风险与建议（含Owner/DDL）；5) 自检清单。",
    "max_chars": 3600,
    "styleSpecHints": {
      "writer": {
        "font": {
          "body": {
            "name": "??",
            "size": 12
          }
        },
        "table": {
          "header": {
            "bold": true,
            "fill": "#f1f5f9"
          }
        }
      },
      "group": "bidding",
      "schema": "ah32.styleSpecHints.v1"
    }
  },
  "entry": {
    "system_prompt": "SYSTEM.md"
  },
  "capabilities": {
    "rag_missing_hint": true
  },
  "tools": [
    {
      "name": "generate_timeline",
      "description": "从招标文档提取里程碑时间线，包括资格审查、现场探勘、答疑截止、投标截止等关键日期。自动计算剩余天数并标注来源章节。",
      "parameters": {
        "type": "object",
        "properties": {
          "bid_doc_text": {
            "type": "string",
            "description": "招标文档全文内容"
          },
          "reference_date": {
            "type": "string",
            "description": "参考日期（格式：YYYY-MM-DD），默认今天"
          }
        },
        "required": ["bid_doc_text"]
      }
    },
    {
      "name": "check_compliance",
      "description": "逐条检查投标文件与招标文件的符合性，识别符合、偏离、待确认项。生成符合性矩阵和高风险项清单。",
      "parameters": {
        "type": "object",
        "properties": {
          "tender_doc": {
            "type": "string",
            "description": "招标文件内容"
          },
          "bid_doc": {
            "type": "string",
            "description": "投标文件内容，用于对比"
          }
        },
        "required": ["tender_doc"]
      }
    },
    {
      "name": "generate_checklist",
      "description": "生成封标前检查清单，包括签章完整性、密封要求、授权委托书、报价完整性等10项检查。判断是否满足封标条件。",
      "parameters": {
        "type": "object",
        "properties": {
          "bid_doc": {
            "type": "string",
            "description": "投标文件内容，用于检查"
          },
          "tender_doc": {
            "type": "string",
            "description": "招标文件内容，用于检查密封要求"
          }
        },
        "required": []
      }
    },
    {
      "name": "check_policy_update",
      "description": "手动触发政策更新检查（默认24小时TTL缓存），并将新增政策保存为结构化JSON到 data/rag/policies/（可写时）。抓取失败会返回缓存并提示原因。",
      "hints": {
        "turn_mode": "background",
        "triggers": [
          "政策更新",
          "检查政策更新",
          "抓取最新政策",
          "抓取政策",
          "政策入库",
          "同步政策"
        ]
      },
      "parameters": {
        "type": "object",
        "properties": {
          "force_refresh": {
            "type": "boolean",
            "description": "是否强制刷新（跳过TTL）"
          },
          "ttl_hours": {
            "type": "integer",
            "description": "缓存有效期（小时），默认24"
          },
          "max_items": {
            "type": "integer",
            "description": "最多抓取的政策条数，默认10"
          },
          "record_trace": {
            "type": "boolean",
            "description": "是否记录Playwright trace（落盘到storage/browser_traces/），默认false"
          },
          "timeout_ms": {
            "type": "integer",
            "description": "页面超时（毫秒），默认30000"
          }
        },
        "required": []
      }
    },
    {
      "name": "get_latest_policies",
      "description": "读取本地 data/rag/policies/*.json（或fallback到storage）并按发布日期倒序返回最新政策摘要列表。",
      "hints": {
        "turn_mode": "background",
        "triggers": [
          "最新政策",
          "查看政策",
          "列出政策",
          "政策列表"
        ]
      },
      "parameters": {
        "type": "object",
        "properties": {
          "limit": {
            "type": "integer",
            "description": "返回条数，默认10"
          }
        },
        "required": []
      }
    },
    {
      "name": "ingest_url_to_rag",
      "description": "抓取网页URL正文（纯文本）并导入到RAG向量库；支持scope=global|project（项目优先需提供context_document_path以推导项目）。抓取失败会返回可诊断原因（不可达/超时/验证码/登录/正文为空），兜底建议用户粘贴纯文本或上传文件导入。",
      "hints": {
        "turn_mode": "background",
        "triggers": [
          "URL入库",
          "抓取URL",
          "抓取网页入库",
          "爬取入库",
          "把链接导入RAG",
          "导入网页"
        ]
      },
      "parameters": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "description": "要抓取并入库的网页URL（http/https）"
          },
          "title": {
            "type": "string",
            "description": "可选：入库文档标题（不填则用网页title或final_url）"
          },
          "scope": {
            "type": "string",
            "description": "可选：global|project；不填时默认：若能从context_document_path推导项目则project，否则global"
          },
          "context_document_path": {
            "type": "string",
            "description": "可选：当前项目/文档路径，用于推导项目范围（project scope）"
          },
          "record_trace": {
            "type": "boolean",
            "description": "可选：是否记录Playwright trace（用于定位抓取失败）"
          },
          "timeout_ms": {
            "type": "integer",
            "description": "可选：页面超时（毫秒）"
          }
        },
        "required": ["url"]
      }
    }
  ]
}
